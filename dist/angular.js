!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=function(){function e(){}return e.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n={},r=e.length-1;r>=0;r--){var i=e[r];for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])}return n},e.lcfirst=function(e){return e.charAt(0).toLowerCase()+e.substr(1)},e.appendInItsOwnLine=function(e,t){return(e+"\n\n[[D]]"+t).replace(/(\n{2,})\[\[D\]\]/,"\n\n").replace(/^(\n*)/,"")},e.insertTextAtCursor=function(e,t){var n,r=e.scrollTop,i=0,o=!1;e.selectionStart||0===e.selectionStart?o="ff":document.selection&&(o="ie"),"ie"===o?(e.focus(),(n=document.selection.createRange()).moveStart("character",-e.value.length),i=n.text.length):"ff"===o&&(i=e.selectionStart||0);var a=e.value.substring(0,i),s=e.value.substring(i,e.value.length);e.value=a+t+s,i+=t.length,"ie"===o?(e.focus(),(n=document.selection.createRange()).moveStart("character",-e.value.length),n.moveStart("character",i),n.moveEnd("character",0),n.select()):"ff"===o&&(e.selectionStart=i,e.selectionEnd=i,e.focus()),e.scrollTop=r},e}(),i={uploadUrl:"upload_attachment.php",uploadMethod:"POST",uploadFieldName:"file",defaultExtension:"png",jsonFieldName:"filename",allowedTypes:["image/jpeg","image/png","image/jpg","image/gif"],progressText:"![Uploading file...]()",urlText:"![file]({filename})",errorText:"Error uploading file",extraParams:{},extraHeaders:{},beforeFileUpload:function(){return!0},onFileReceived:function(){return!0},onFileUploadResponse:function(){return!0},onFileUploadError:function(){return!0},onFileUploaded:function(){}},o=function(){function e(e,t){this.settings=r.merge(t,i),this.editor=e,this.filenameTag="{filename}",this.lastValue=null}return e.prototype.uploadFile=function(e){var t=this,n=new FormData,r=new XMLHttpRequest,i=this.settings,o=i.defaultExtension;if("function"==typeof i.setupFormData&&i.setupFormData(n,e),e.name){var a=e.name.match(/\.(.+)$/);a&&(o=a[1])}var s="image-"+Date.now()+"."+o;if("function"==typeof i.remoteFilename&&(s=i.remoteFilename(e)),n.append(i.uploadFieldName,e,s),"object"==typeof i.extraParams)for(var l in i.extraParams)i.extraParams.hasOwnProperty(l)&&n.append(l,i.extraParams[l]);if(r.open("POST",i.uploadUrl),"object"==typeof i.extraHeaders)for(var u in i.extraHeaders)i.extraHeaders.hasOwnProperty(u)&&r.setRequestHeader(u,i.extraHeaders[u]);(r.onload=function(){200===r.status||201===r.status?t.onFileUploadResponse(r):t.onFileUploadError(r)},i.beforeFileUpload)&&(!1!==i.beforeFileUpload(r)&&r.send(n));return r},e.prototype.isFileAllowed=function(e){return"string"!==e.kind&&(0===this.settings.allowedTypes.indexOf("*")||this.settings.allowedTypes.indexOf(e.type)>=0)},e.prototype.onFileUploadResponse=function(e){if(this.settings.onFileUploadResponse&&this.lastValue&&!1!==this.settings.onFileUploadResponse.call(this,e)){var t=JSON.parse(e.responseText),n=t[this.settings.jsonFieldName];if(t&&n){var r;r="function"==typeof this.settings.urlText?this.settings.urlText.call(this,n,t):this.settings.urlText.replace(this.filenameTag,n);var i=this.editor.getValue().replace(this.lastValue,r);this.editor.setValue(i),this.settings.onFileUploaded&&this.settings.onFileUploaded.call(this,n)}}},e.prototype.onFileUploadError=function(e){if(this.settings.onFileUploadError&&this.lastValue&&!1!==this.settings.onFileUploadError.call(this,e)){var t=this.editor.getValue().replace(this.lastValue,this.settings.errorText);this.editor.setValue(t)}},e.prototype.onFileInserted=function(e){this.settings.onFileReceived&&!1!==this.settings.onFileReceived.call(this,e)&&(this.lastValue=this.settings.progressText,this.editor.insertValue(this.lastValue))},e.prototype.onPaste=function(e){var t,n=e.clipboardData,r=!1;if("object"==typeof n){t=n.items||n.files||[];for(var i=0;i<t.length;i++){var o=t[i];this.isFileAllowed(o)&&(r=!0,this.onFileInserted(o.getAsFile()),this.uploadFile(o.getAsFile()))}}return r&&e.preventDefault(),r},e.prototype.onDrop=function(e){for(var t=!1,n=0;n<e.dataTransfer.files.length;n++){var r=e.dataTransfer.files[n];this.isFileAllowed(r)&&(t=!0,this.onFileInserted(r),this.uploadFile(r))}return t},e}(),a=function(){function e(e,t){this.instance=e,this.options=t,this.bind()}return e.prototype.getInlineAttachment=function(){return this.inlineAttachment},e.prototype.getValue=function(){return this.instance.value},e.prototype.insertValue=function(e){r.insertTextAtCursor(this.instance,e)},e.prototype.setValue=function(e){this.instance.value=e},e.prototype.bind=function(){var e=this.inlineAttachment||(this.inlineAttachment=new o(this,this.options));this.instance.addEventListener("paste",function(t){e.onPaste(t)},!1),this.instance.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault(),e.onDrop(t)},!1),this.instance.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),this.instance.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1)},e}(),s="inlineattachment",l=angular.module(s,[]);l.directive(s,function(){return function(e,t,n){var i=function(e,t){var n,i,o={},a=e.$attr,l=!0,u=!1,p=void 0;try{for(var c,f=Object.keys(a)[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var d=c.value;n=r.lcfirst(d.substr(s.length)),i=e[d],n.length>0&&d.substring(0,s.length)===s&&(o[n]=i,"function"==typeof t[i]&&(o[n]=t[i]))}}catch(e){u=!0,p=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw p}}return o}(n,e);new a(t[0],i)}});t.default=l}]);